# ðŸš€ NestJS Deployment Checklist

## Pre-Deployment Setup

### 1. **Package.json Configuration**
```json
{
  "engines": {
    "node": ">=18.0.0",
    "npm": ">=8.0.0"
  },
  "scripts": {
    "start:prod": "node --max-old-space-size=512 dist/main.js",
    "heroku-postbuild": "npm run build && npx prisma generate",
    "postinstall": "npx prisma generate"
  }
}
```

### 2. **Main.ts Production Configuration**
```typescript
// Always bind to 0.0.0.0 for cloud deployment
await app.listen(port, '0.0.0.0');

// Add health check endpoint
app.getHttpAdapter().get('/', (req, res) => {
  res.json({ 
    status: 'ok', 
    message: 'API is running!',
    timestamp: new Date().toISOString()
  });
});
```

### 3. **Environment Variables Required**
- `NODE_ENV=production`
- `DATABASE_URL=your_connection_string`
- `JWT_SECRET=your_jwt_secret`
- `PORT` (auto-generated by hosting)

### 4. **File Structure Validation**
```bash
# Test locally before deployment
npm run build
npm run start:prod
```

## Deployment Platform Configuration

### **Render.com Settings**
- **Build Command:** `npm ci && npm run build && npx prisma generate`
- **Start Command:** `node --max-old-space-size=512 dist/main.js`
- **Node Version:** Specify in `.nvmrc` file

### **Heroku Settings**
- **Procfile:** `web: npm run start:prod`
- **Add heroku-postbuild script** (automatically runs)

### **Vercel/Netlify Functions**
- Use `@nestjs/platform-express` adapter
- Configure serverless function entry point

## Common Issues Prevention

### âœ… **DTO Naming Conflicts**
- Use descriptive, unique names across modules
- Example: `CreateUserDto`, `UpdateOrderInfoDto`, `AdminOrderUpdateDto`

### âœ… **Memory Management**
- Always use `--max-old-space-size=512` for production
- Monitor memory usage in hosting dashboard

### âœ… **Port Binding**
- Never use `localhost` in production
- Always use `0.0.0.0` and dynamic port

### âœ… **Build Verification**
- Test `npm run build` locally
- Verify `dist/` folder contains all files
- Test production start command

### âœ… **Environment Setup**
- Set `NODE_ENV=production`
- Use environment-specific database URLs
- Never commit sensitive keys

## Troubleshooting Commands

```bash
# Clean build
rm -rf dist node_modules package-lock.json
npm install
npm run build

# Test production locally
npm run start:prod

# Debug startup
node --inspect dist/main.js
```

## Post-Deployment Verification

1. âœ… Health check endpoint responds: `GET /`
2. âœ… API documentation accessible: `GET /api`
3. âœ… Database connection working
4. âœ… Authentication endpoints functional
5. âœ… File upload (if applicable) working
6. âœ… Memory usage within limits

## Emergency Rollback Plan

1. **Keep previous working commit hash**
2. **Have environment variables backed up**
3. **Test rollback process in staging first**
4. **Monitor logs during rollback**

---

## Quick Reference Commands

```bash
# Local development
npm run start:dev

# Production build
npm run build

# Production start
npm run start:prod

# Database operations
npx prisma generate
npx prisma db push
npx prisma migrate deploy
``` 